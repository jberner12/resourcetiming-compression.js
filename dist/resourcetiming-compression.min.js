!function(S){"use strict";void 0!==S&&(e=(t=S).ResourceTimingCompression);var t,e,p={};function A(e,r,t){Array.prototype.forEach.call(e.ownerDocument.getElementsByTagName(t),function(t){e.href=t.currentSrc||t.src||t.getAttribute("xlink:href")||t.href,e.href.match(/^https?:\/\//)&&(r[e.href]=t)})}p.HOSTNAMES_REVERSED=!0,p.INITIATOR_TYPES={other:0,img:1,link:2,script:3,css:4,xmlhttprequest:5,html:6,image:7,beacon:8,fetch:9,iframe:"a",subdocument:"a",body:"b",input:"c",frame:"a",object:"d",video:"e",audio:"f",source:"g",track:"h",embed:"i",eventsource:"j",navigation:6},p.DEFAULT_XSS_BREAK_WORDS=[/(h)(ref)/gi,/(s)(rc)/gi,/(a)(ction)/gi],p.XSS_BREAK_DELIM="\n",p.DEFAULT_URL_LIMIT=500,p.SPECIAL_DATA_PREFIX="*",p.SPECIAL_DATA_DIMENSION_TYPE="0",p.SPECIAL_DATA_SIZE_TYPE="1",p.SPECIAL_DATA_SCRIPT_TYPE="2",p.SPECIAL_DATA_SCRIPT_ASYNC_ATTR=1,p.SPECIAL_DATA_SCRIPT_DEFER_ATTR=2,p.SPECIAL_DATA_SCRIPT_LOCAT_ATTR=4,p.SPECIAL_DATA_SERVERTIMING_TYPE="3",p.SPECIAL_DATA_LINK_ATTR_TYPE="4",p.SPECIAL_DATA_NAMESPACED_TYPE="5",p.SPECIAL_DATA_SERVICE_WORKER_TYPE="6",p.SPECIAL_DATA_PROTOCOL="7",p.REL_TYPES={prefetch:1,preload:2,prerender:3,stylesheet:4},p.HOSTNAME_REGEX=/^(https?:\/\/)([^/]+)(.*)/,p.trimUrls=[],p.xssBreakWords=p.DEFAULT_XSS_BREAK_WORDS,p.noConflict=function(){return t.ResourceTimingCompression=e,p},p.roundUpTiming=function(t){return"number"!=typeof t&&(t=0),Math.ceil(t||0)},p.convertToTrie=function(t){var e,r,n,i,o,a,s,c,d={};for(e in t)if(Object.prototype.hasOwnProperty.call(t,e)){for(r=e,n=0;n<this.xssBreakWords.length;n++)r=r.replace(this.xssBreakWords[n],"$1"+p.XSS_BREAK_DELIM+"$2");for(i=t[e],o=r.split(""),s=d,n=0;n<o.length;n++)void 0===(c=s[a=o[n]])?s=s[a]=n===o.length-1?i:{}:"string"==typeof c?s=s[a]={"|":c}:n===o.length-1?s[a]["|"]=i:s=s[a]}return d},p.optimizeTrie=function(t,e){var r,n,i,o=0,a=[];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&a.push(r);for(var s=0;s<a.length;s++)"object"==typeof t[r=a[s]]&&(n=this.optimizeTrie(t[r],!1))&&(delete t[r],r===p.XSS_BREAK_DELIM?(r=n.name,o++):r+=n.name,t[r]=n.value),o++;return 1===o?e?((i={})[r]=t[r],i):{name:r,value:t[r]}:!!e&&t},p.trimTiming=function(t,e){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0);t=Math.round(t||0),e=Math.round(e||0);return 0===t?0:t-e},p.getNavStartTime=function(t){var e=0;if(t)try{t.location&&t.location.href,"performance"in t&&t.performance&&t.performance.timing&&t.performance.timing.navigationStart&&(e=t.performance.timing.navigationStart)}catch(t){}return e},p.findPerformanceEntriesForFrame=function(t,e,r,n){var i,o,a,s,c,d,u,m,S=[],p={},T={};if(void 0===e&&(e=!0),void 0===r&&(r=0),!(10<(n=void 0===n?0:n)))try{if(o=this.getNavStartTime(t),A(m=t.document.createElement("a"),T,"script"),A(m,p,"link"),t.frames)for(g=0;g<t.frames.length;g++)s=o<(a=this.getNavStartTime(t.frames[g]))?r+(a-o):0,S=S.concat(this.findPerformanceEntriesForFrame(t.frames[g],!1,s,++n));try{if(t.location&&t.location.href,!("performance"in t&&t.performance&&t.performance.getEntriesByType))return S}catch(t){return S}e&&((i=t.performance.getEntriesByType("navigation"))&&1===i.length?(c=i[0],S.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:c.redirectStart,redirectEnd:c.redirectEnd,fetchStart:c.fetchStart,domainLookupStart:c.domainLookupStart,domainLookupEnd:c.domainLookupEnd,connectStart:c.connectStart,secureConnectionStart:c.secureConnectionStart,connectEnd:c.connectEnd,requestStart:c.requestStart,responseStart:c.responseStart,responseEnd:c.responseEnd,serverTiming:c.serverTiming||[],nextHopProtocol:c.nextHopProtocol})):t.performance.timing&&0!==(d=t.performance.timing).navigationStart&&d.responseEnd<=d.navigationStart+36e5&&S.push({name:t.location.href,startTime:0,initiatorType:"html",redirectStart:d.redirectStart?d.redirectStart-d.navigationStart:0,redirectEnd:d.redirectEnd?d.redirectEnd-d.navigationStart:0,fetchStart:d.fetchStart?d.fetchStart-d.navigationStart:0,domainLookupStart:d.domainLookupStart?d.domainLookupStart-d.navigationStart:0,domainLookupEnd:d.domainLookupEnd?d.domainLookupEnd-d.navigationStart:0,connectStart:d.connectStart?d.connectStart-d.navigationStart:0,secureConnectionStart:d.secureConnectionStart?d.secureConnectionStart-d.navigationStart:0,connectEnd:d.connectEnd?d.connectEnd-d.navigationStart:0,requestStart:d.requestStart?d.requestStart-d.navigationStart:0,responseStart:d.responseStart?d.responseStart-d.navigationStart:0,responseEnd:d.responseEnd?d.responseEnd-d.navigationStart:0}));for(var f=t.performance.getEntriesByType("resource"),E=[],g=0;f&&g<f.length;g++)u={name:(d=f[g]).name,initiatorType:d.initiatorType,startTime:d.startTime+r,redirectStart:d.redirectStart?d.redirectStart+r:0,redirectEnd:d.redirectEnd?d.redirectEnd+r:0,fetchStart:d.fetchStart?d.fetchStart+r:0,domainLookupStart:d.domainLookupStart?d.domainLookupStart+r:0,domainLookupEnd:d.domainLookupEnd?d.domainLookupEnd+r:0,connectStart:d.connectStart?d.connectStart+r:0,secureConnectionStart:d.secureConnectionStart?d.secureConnectionStart+r:0,connectEnd:d.connectEnd?d.connectEnd+r:0,requestStart:d.requestStart?d.requestStart+r:0,responseStart:d.responseStart?d.responseStart+r:0,responseEnd:d.responseEnd?d.responseEnd+r:0,nextHopProtocol:d.nextHopProtocol},(d.encodedBodySize||d.decodedBodySize||d.transferSize)&&(u.encodedBodySize=d.encodedBodySize,u.decodedBodySize=d.decodedBodySize,u.transferSize=d.transferSize),d.serverTiming&&d.serverTiming.length&&(u.serverTiming=d.serverTiming),this.updateScriptFlags(T,d,u),this.updateLinkFlags(p,d,u),E.push(u);S=S.concat(E)}catch(t){}return S},p.updateScriptFlags=function(t,e,r){if(("script"===e.initiatorType||"link"===e.initiatorType)&&t[e.name]){var n=t[e.name];for(r.scriptAttrs=(n.async?p.SPECIAL_DATA_SCRIPT_ASYNC_ATTR:0)|(n.defer?p.SPECIAL_DATA_SCRIPT_DEFER_ATTR:0);1===n.nodeType&&"BODY"!==n.nodeName;)n=n.parentNode;r.scriptAttrs|="BODY"===n.nodeName?p.SPECIAL_DATA_SCRIPT_LOCAT_ATTR:0}},p.updateLinkFlags=function(t,e,r){"link"===e.initiatorType&&t[e.name]&&t[e.name].rel.split(/[\u0009\u000A\u000C\u000D\u0020]+/).find(function(t){return t=t.toLowerCase(),!!p.REL_TYPES[t]&&(r.linkAttrs=p.REL_TYPES[t],!0)})},p.toBase36=function(t){return"number"==typeof t&&0!==t?t.toString(36):"string"==typeof t?t:""},p.getVisibleEntries=function(t){var s,c,d,u,m;return t?(s={},c=t.document,d=c.createElement("A"),u=void 0!==t.pageXOffset?t.pageXOffset:(c.documentElement||c.body.parentNode||c.body).scrollLeft,m=void 0!==t.pageYOffset?t.pageYOffset:(c.documentElement||c.body.parentNode||c.body).scrollTop,["img","iframe","image"].forEach(function(t){for(var e,r,n,i,o=c.getElementsByTagName(t),a=0;a<o.length;a++)(i=o[a])&&(n=i.currentSrc||i.src||"function"==typeof i.getAttribute&&i.getAttribute("src")||i.getAttribute("xlink:href"),d.href=n,(n=d.href)&&!s[n]&&((r=i.getBoundingClientRect()).height||i.offsetHeight)&&(r.width||i.offsetWidth)&&(s[n]=[r.height||i.offsetHeight,r.width||i.offsetWidth,Math.round(r.top+m),Math.round(r.left+u)],(i.naturalHeight||i.naturalWidth)&&(i.currentSrc&&(i.srcset||i.parentNode&&i.parentNode.nodeName&&"PICTURE"===i.parentNode.nodeName.toUpperCase())?(e=i.isConnected?i.ownerDocument.createElement("IMG"):new S.Image).src=n:e=i,r=e.naturalHeight||i.naturalHeight,i=e.naturalWidth||i.naturalWidth,!r&&!i||s[n][0]===r&&s[n][1]===i||s[n].push(r,i))))}),s):{}},p.inArray=function(t,e){var r;if(void 0!==t&&void 0!==e&&e.length)for(r=0;r<e.length;r++)if(e[r]===t)return!0;return!1},p.getFilteredResourceTiming=function(t,e,r,n){var i,o=this.findPerformanceEntriesForFrame(t,!0,0,0),a=this.getNavStartTime(t),s={};if(!o||!o.length)return{entries:[]};for(var c=[],d=0;d<o.length;d++)if(0!==(i=o[d]).name.indexOf("about:")&&0!==i.name.indexOf("javascript:")&&!(e&&a+i.startTime<e)){if(r&&a+i.startTime>r)break;(void 0===n||"*"===n||!n.length||i.initiatorType&&this.inArray(i.initiatorType,n))&&(p.accumulateServerTimingEntries(s,i.serverTiming),c.push(i))}t=p.compressServerTiming(s);return{entries:c,serverTiming:{lookup:t,indexed:p.indexServerTiming(t)}}},p.compressSize=function(t){var e,r;return t.encodedBodySize||t.decodedBodySize||t.transferSize?(e=t.transferSize,[r=t.encodedBodySize,e?e-r:"_",t.decodedBodySize-r].map(this.toBase36).join(",").replace(/,+$/,"")):""},p.cleanupURL=function(t,e){var r;return t&&"[object Array]"!==Object.prototype.toString.call(t)?void 0!==e&&t&&t.length>e?-1!==(r=t.indexOf("?"))&&r<e?t.substr(0,r)+"?...":t.substr(0,e-3)+"...":t:""},p.trimUrl=function(t,e){var r,n,i;if(t&&e)for(r=0;r<e.length;r++)if("string"==typeof(i=e[r])){if(-1!==(n=t.indexOf(i))){t=t.substr(0,n+i.length)+"...";break}}else i instanceof RegExp&&i.test(t)&&(t=t.replace(i,"$1")+"...");return this.cleanupURL(t,p.DEFAULT_URL_LIMIT)},p.getResourceTiming=function(t,e,r,n){void 0===t&&(t=S);e=p.getFilteredResourceTiming(t,e,r),r=e.entries,e=e.serverTiming;return r&&r.length?p.compressResourceTiming(t,r,e,n):{}},p.isCacheHit=function(t){return!(0<t.transferSize)&&(0<t.decodedBodySize||t.duration<30)},p.compressResourceTiming=function(t,e,i,r){var n,o={},a={};for(r||(a=this.getVisibleEntries(t)),n=0;n<e.length;n++){var s,c=e[n],d=(d=void 0===(d=this.INITIATOR_TYPES[c.initiatorType])?0:d)+[this.trimTiming(c.startTime,0),this.trimTiming(c.responseEnd,c.startTime),this.trimTiming(c.responseStart,c.startTime),this.trimTiming(c.requestStart,c.startTime),this.trimTiming(c.connectEnd,c.startTime),this.trimTiming(c.secureConnectionStart,c.startTime),this.trimTiming(c.connectStart,c.startTime),this.trimTiming(c.domainLookupEnd,c.startTime),this.trimTiming(c.domainLookupStart,c.startTime),this.trimTiming(c.redirectEnd,c.startTime),this.trimTiming(c.redirectStart,c.startTime)].map(this.toBase36).join(",").replace(/,+$/,""),u=this.compressSize(c);if(""!==u&&(d+=p.SPECIAL_DATA_PREFIX+p.SPECIAL_DATA_SIZE_TYPE+u),Object.prototype.hasOwnProperty.call(c,"scriptAttrs")&&(d+=p.SPECIAL_DATA_PREFIX+p.SPECIAL_DATA_SCRIPT_TYPE+c.scriptAttrs),Object.prototype.hasOwnProperty.call(c,"linkAttrs")&&(d+=p.SPECIAL_DATA_PREFIX+p.SPECIAL_DATA_LINK_ATTR_TYPE+c.linkAttrs),c.serverTiming&&c.serverTiming.length&&(d+=p.SPECIAL_DATA_PREFIX+p.SPECIAL_DATA_SERVERTIMING_TYPE+c.serverTiming.reduce(function(t,e,r){var n=String(e.duration),e=("0."===n.substring(0,2)&&(n=n.substring(1)),p.identifyServerTimingEntry(i.indexed[e.name].index,i.indexed[e.name].descriptions[e.description]));return t+=(0<r?",":"")+n+e},"")),c.workerStart&&"number"==typeof c.workerStart&&0!==c.workerStart&&(u=this.trimTiming(p.roundUpTiming(c.workerStart),c.startTime),s=this.trimTiming(p.roundUpTiming(c.fetchStart),c.startTime),d+=p.SPECIAL_DATA_PREFIX+p.SPECIAL_DATA_SERVICE_WORKER_TYPE+this.toBase36(u)+(s!==u?","+this.toBase36(s):"")),s=u=this.trimUrl(c.name,this.trimUrls),p.HOSTNAMES_REVERSED&&(s=this.reverseHostname(u)),Object.prototype.hasOwnProperty.call(c,"nextHopProtocol")&&""!==c.nextHopProtocol&&!p.isCacheHit(c)&&(d+=p.SPECIAL_DATA_PREFIX+p.SPECIAL_DATA_PROTOCOL+c.nextHopProtocol.replace("http/","h")),Object.prototype.hasOwnProperty.call(c,"_data")){var m,S="";for(m in c._data)Object.prototype.hasOwnProperty.call(c._data,m)&&(S+=p.SPECIAL_DATA_PREFIX+p.SPECIAL_DATA_NAMESPACED_TYPE+m+":"+c._data[m]);void 0===o[u]?o[u]=d+S:o[u]+=S}else void 0!==o[s]?o[s]+="|"+d:void 0!==a[u]?o[s]=p.SPECIAL_DATA_PREFIX+p.SPECIAL_DATA_DIMENSION_TYPE+a[u].map(this.toBase36).join(",").replace(/,+$/,"")+"|"+d:o[s]=d}return{restiming:this.optimizeTrie(this.convertToTrie(o),!0),servertiming:i.lookup}},p.reverseHostname=function(t){return t.replace(p.HOSTNAME_REGEX,function(t,e,r,n){return e+p.reverseString(r)+n})},p.reverseString=function(t){for(var e=t.length,r="";e--;)r+=t[e];return r},p.accumulateServerTimingEntries=function(r,t){(t||[]).forEach(function(t){void 0===r[t.name]&&(r[t.name]={count:0,counts:{}});var e=r[t.name];e.counts[t.description]=e.counts[t.description]||0,e.counts[t.description]++,e.count++})},p.compressServerTiming=function(n){return Object.keys(n).sort(function(t,e){return n[e].count-n[t].count}).reduce(function(t,r){var e=Object.keys(n[r].counts).sort(function(t,e){return n[r].counts[e]-n[r].counts[t]});return t.push(1===e.length&&""===e[0]?r:[r].concat(e)),t},[])},p.indexServerTiming=function(t){return t.reduce(function(t,e,r){var n,e=Array.isArray(e)?(n=e[0],e.slice(1).reduce(function(t,e,r){return t[e]=r,t},{})):(n=e,{"":0});return t[n]={index:r,descriptions:e},t},{})},p.identifyServerTimingEntry=function(t,e){var r="";return t&&(r+=t),e&&(r+="."+e),r=r.length?":"+r:r},"function"==typeof define&&define.amd?define([],function(){return p}):"undefined"!=typeof module&&module.exports?module.exports=p:void 0!==t&&(t.ResourceTimingCompression=p)}("undefined"!=typeof window?window:void 0);